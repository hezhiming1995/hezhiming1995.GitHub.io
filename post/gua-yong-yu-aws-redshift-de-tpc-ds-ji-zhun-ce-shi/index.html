<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    Zhiming&#39;s Blog
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://fastly.jsdelivr.net">
<meta name="author" content="何志明">
<meta name="description" content="岁月神偷 | Time always catches us off guard.">
<meta name="keywords" content="博客,Blog">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://hezhiming1995.github.io/styles/main.css" />
<link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://fastly.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                    <script src="https://fastly.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/assets/media/script/APlayer.min.js"></script>
                    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
                    
                        <!--CDN样式-->
                        <script src="https://fastly.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
                                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125965338-1"></script>
                                <script>
                                    window.dataLayer = window.dataLayer || [];

                                    function gtag() {
                                        dataLayer.push(arguments);
                                    }
                                    gtag('js', new Date());
                                    gtag('config', 'UA-125965338-1');
                                </script>
                                
                                    <script type="text/javascript">
                                        var _hmt = _hmt || [];
                                        (function() {
                                            var hm = document.createElement("script");
                                            hm.src = "https://hm.baidu.com/hm.js?9e2f8f8de7b9bf79e4980a6930dc53c5";
                                            var s = document.getElementsByTagName("script")[0];
                                            s.parentNode.insertBefore(hm, s);
                                        })();
                                    </script>
                                    
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://hezhiming1995.github.io">
                    Zhiming&#39;s Blog
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="https://hezhiming1995.github.io">
                        首页
                    </a>
                    
                    <a class="menu-item" href="/posts">
                        文章
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        归档
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        标签
                    </a>
                    
                    <a class="menu-item" href="https://hezhiming1995.github.io/post/resume">
                        About Me
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1700489200796" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://hezhiming1995.github.io">
                            Zhiming&#39;s Blog
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1700489200796" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="https://hezhiming1995.github.io">
                            首页
                        </a>
                        
                        <a class="menu-item" href="/posts">
                            文章
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            归档
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            标签
                        </a>
                        
                        <a class="menu-item" href="https://hezhiming1995.github.io/post/resume">
                            About Me
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                适用于 AWS Redshift 的 TPC-DS 基准测试
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            Zhiming's Blog
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">2021-08-25</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">18.8
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">4117</a></span>
                                        
                                            <span class="post-category">&#x5206;&#x7C7B;:
                                
                                <a href="https://hezhiming1995.github.io/tag/redshift/">Redshift</a>
                                
                                <a href="https://hezhiming1995.github.io/tag/tpc-ds/">TPC-DS</a>
                                
                                <a href="https://hezhiming1995.github.io/tag/benchmark/">Benchmark</a>
                                
                                <a href="https://hezhiming1995.github.io/tag/data-warehouse/">Data Warehouse</a>
                                
                                <a href="https://hezhiming1995.github.io/tag/shu-ju-cang-ku/">数据仓库</a>
                                
                                <a href="https://hezhiming1995.github.io/tag/ji-zhun-ce-shi/">基准测试</a>
                                
                            </span>
                                            
                                                阅读量:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                            <img class="post-feature-image" src="https://hezhiming1995.github.io/post-images/gua-yong-yu-aws-redshift-de-tpc-ds-ji-zhun-ce-shi.png" alt="">
                          
                        <div class="post-content">
                            <p><ul class="markdownIt-TOC">
<li><a href="#%E9%80%82%E7%94%A8%E4%BA%8E-aws-redshift-%E7%9A%84-tpc-ds-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95">适用于 AWS Redshift 的 TPC-DS 基准测试</a>
<ul>
<li><a href="#1-%E7%BB%84%E4%BB%B6%E7%8E%AF%E5%A2%83">1. 组件环境</a><br>
*
<ul>
<li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AFtpc-ds">1.1 什么是TPC-DS？</a></li>
<li><a href="#12-tpc-ds%E7%9A%84%E7%89%B9%E6%80%A7">1.2 TPC-DS的特性</a></li>
<li><a href="#13-tpc-ds-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%BB%B4%E5%BA%A6">1.3 TPC-DS 基准测试维度</a></li>
<li><a href="#14-tpc-ds-%E6%B5%8B%E8%AF%95%E8%A1%A8%E6%95%B0%E6%8D%AE%E8%AF%A6%E6%83%85">1.4 TPC-DS 测试表数据详情</a></li>
</ul>
</li>
<li><a href="#2-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B">2. 测试流程</a><br>
*
<ul>
<li><a href="#21-%E7%94%B3%E8%AF%B7tpc%E5%AE%98%E6%96%B9benchmark%E5%B7%A5%E5%85%B7%E5%8C%85%E5%8F%8A%E6%96%87%E6%A1%A3">2.1 申请TPC官方Benchmark工具包及文档</a></li>
<li><a href="#22-%E5%AE%89%E8%A3%85tpc-ds%E5%B7%A5%E5%85%B7%E5%8C%85-base-on-linux">2.2 安装TPC-DS工具包 （base on Linux）</a></li>
<li><a href="#23-%E4%BF%AE%E6%94%B9%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5%E4%BD%BF%E5%85%B6%E7%AC%A6%E5%90%88-aws-redshift-%E6%A0%87%E5%87%86%E7%9A%84ddl">2.3 修改建表语句，使其符合 AWS Redshift 标准的DDL</a></li>
<li><a href="#24-%E6%9E%84%E5%BB%BA%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E9%9B%86">2.4 构建测试数据集</a></li>
<li><a href="#25-%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0redshift%E4%B8%AD">2.5 加载数据到Redshift中</a></li>
<li><a href="#26-%E7%94%9F%E6%88%90redshift%E6%A0%87%E5%87%86%E6%9F%A5%E8%AF%A2%E6%B5%81">2.6 生成Redshift标准查询流</a></li>
</ul>
</li>
<li><a href="#3-%E4%BF%AE%E6%94%B9%E4%B8%BAredshift%E6%A0%87%E5%87%86%E8%AF%AD%E6%B3%95%E7%9A%84%E6%9F%A5%E8%AF%A2query">3. 修改为Redshift标准语法的查询Query</a></li>
<li><a href="#4-%E6%89%A7%E8%A1%8Cquery%E7%BB%9F%E8%AE%A1%E6%97%B6%E9%97%B4">4. 执行Query，统计时间</a><br>
*
<ul>
<li><a href="#41-%E8%84%9A%E6%9C%AC%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8Cquery-python">4.1 脚本后台执行Query (python)</a></li>
</ul>
</li>
<li><a href="#5-%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA">5. 结果展示</a><br>
*
<ul>
<li><a href="#51-%E7%BB%93%E8%AE%BA">5.1 结论</a></li>
</ul>
</li>
<li><a href="#6-references">6 References</a></li>
</ul>
</li>
</ul>
( )</p>
<h1 id="适用于-aws-redshift-的-tpc-ds-基准测试">适用于 AWS Redshift 的 TPC-DS 基准测试</h1>
<p>简体中文 | <a href="https://zhuanlan.zhihu.com/p/403124019">English</a><br>
日期：2021年08月24日<br>
作者：何志明（自编辑&amp;整理）</p>
<h2 id="1-组件环境">1. 组件环境</h2>
<table>
<thead>
<tr>
<th><strong>Redshift</strong></th>
<th><strong>TPC-DS</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>dc2.large | 3 nodes | 480 GB</td>
<td>v3.2.0rc1</td>
</tr>
</tbody>
</table>
<h4 id="11-什么是tpc-ds">1.1 什么是TPC-DS？</h4>
<ul>
<li>什么是TPC？<br>
TPC (事务处理性能测试委员会)，有两个主要职责：一是制定计算机事务处理能力测试标准，二是监督其执行。其总部位于美国，绝大多数会员都是美、日、西欧的大公司。<br>
目前支持数据库三个方向的Benchmark测试，如下图：<br>
<img src="https://img-blog.csdnimg.cn/0f8ff42a4eb24d74b9c84351ac28dbfc.png" alt="TPC对于数据库三个维度的基准测试规范" loading="lazy"></li>
<li>TPC-H <strong>vs</strong> TPC-DS<br>
<strong>数据类型</strong>：<br>
TPC-H: 关系模型第三范式<br>
TPC-DS: 关系模型，星型模型，雪花模型<br>
<strong>性能分析</strong>：<br>
TPC-H：严重依赖于索引，容易被hack<br>
TPC-DS：健壮性好，能够比较客观的反映系统的真实性能<br>
<img src="https://img-blog.csdnimg.cn/09df7180ddfd4d0a92991459f8f49af0.png" alt="TPC-H和TPC-DS比较" loading="lazy"></li>
</ul>
<h4 id="12-tpc-ds的特性">1.2 TPC-DS的特性</h4>
<ul>
<li>数据真实，数据量大，且含<strong>数据倾斜</strong>。</li>
<li>测试案例SQL比较复杂，几乎所有案例都有很高的IO负载和CPU计算需求</li>
<li>测试案例中包含各种业务模型（如分析报告型，迭代式的联机分析型，数据挖掘型等），并且每一个SQL查询测试都是真实的业务需求</li>
<li>TPC-DS v2&amp;v3版本: 性价比计算方式变化</li>
</ul>
<h4 id="13-tpc-ds-基准测试维度">1.3 TPC-DS 基准测试维度</h4>
<ul>
<li>
<p><strong>Power测试</strong>：是用于评测数据库对单个查询流的处理能力;</p>
<ul>
<li>99个SQL查询流只执行一次;</li>
</ul>
</li>
<li>
<p><strong>Throughput测试</strong>：是用于测试DBMS 对多个查询流并发查询和操作的处理能力;</p>
<ul>
<li>数据查询执行两次，每次执行至少20 个以上的并行查询流;   <br>
 </li>
</ul>
</li>
<li>
<p><strong>评价指标</strong>：</p>
<ul>
<li>Performance (QphDS@SF)：反映每秒的有效查询数据量的性能指标，越大越好；</li>
<li>Cost Performance (Price/QphDS@SF)：反映每秒每查询数据量的性价比指标，值越小说明性价比越高；</li>
</ul>
</li>
</ul>
<p> </p>
<h4 id="14-tpc-ds-测试表数据详情">1.4 TPC-DS 测试表数据详情</h4>
<ul>
<li>TPC-DS v3.2.0 |  <strong>Scale:</strong> 100 (GB)  |  <strong>Total bytes:</strong> 102462037125 | <strong>Total:</strong> 102.47 GB</li>
</ul>
<table>
<thead>
<tr>
<th>No.</th>
<th>Table Name</th>
<th>Bytes</th>
<th>GiB</th>
<th>Row Count Estimate</th>
<th>Bytes/Row</th>
<th>Dimension/Fact Table</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>store_sales</td>
<td>40671627884</td>
<td>37.88GiB</td>
<td>28795080</td>
<td>1412</td>
<td>Fact Table</td>
<td>通过Store渠道销售商品的订单信息</td>
</tr>
<tr>
<td>2</td>
<td>catalog_sales</td>
<td>30872465193</td>
<td>28.75GiB</td>
<td>143997072</td>
<td>214</td>
<td>Fact Table</td>
<td>通过Catalog渠道销售商品的订单信息</td>
</tr>
<tr>
<td>3</td>
<td>inventory</td>
<td>8226939134</td>
<td>7.66 GiB</td>
<td>399329984</td>
<td>21</td>
<td>Fact Table</td>
<td>仓储相关信息</td>
</tr>
<tr>
<td>4</td>
<td>web_sales</td>
<td>15391511849</td>
<td>14.33GiB</td>
<td>72001240</td>
<td>214</td>
<td>Fact Table</td>
<td>通过Catalog渠道销售商品的订单信息</td>
</tr>
<tr>
<td>5</td>
<td>store_returns</td>
<td>3455072075</td>
<td>3.22GiB</td>
<td>287997024</td>
<td>12</td>
<td>Fact Table</td>
<td>通过Store渠道销售商品的退货信息</td>
</tr>
<tr>
<td>6</td>
<td>catalog_returns</td>
<td>2264820940</td>
<td>2.11GiB</td>
<td>14404374</td>
<td>157</td>
<td>Fact Table</td>
<td>通过Catalog渠道销售商品的退货信息</td>
</tr>
<tr>
<td>7</td>
<td>web_returns</td>
<td>1046331434</td>
<td>0.97GiB</td>
<td>7197670</td>
<td>145</td>
<td>Fact Table</td>
<td>通过web渠道销售商品的退货信息</td>
</tr>
<tr>
<td>8</td>
<td>customer_demographics</td>
<td>78739296</td>
<td></td>
<td>1920800</td>
<td>41</td>
<td>Dimension Table</td>
<td>客户基本信用情况</td>
</tr>
<tr>
<td>9</td>
<td>customer</td>
<td>267515941</td>
<td></td>
<td>2000000</td>
<td>134</td>
<td>Dimension Table</td>
<td>客户相关信息</td>
</tr>
<tr>
<td>10</td>
<td>item</td>
<td>58162791</td>
<td></td>
<td>204000</td>
<td>285</td>
<td>Dimension Table</td>
<td>商品信息</td>
</tr>
<tr>
<td>11</td>
<td>customer_address</td>
<td>110154196</td>
<td></td>
<td>1000000</td>
<td>110</td>
<td>Dimension Table</td>
<td>客户地址信息</td>
</tr>
<tr>
<td>12</td>
<td>date_dim</td>
<td>10244389</td>
<td></td>
<td>73049</td>
<td>140</td>
<td>Dimension Table</td>
<td>时间（日历）维度信息</td>
</tr>
<tr>
<td>13</td>
<td>time_dim</td>
<td>5021380</td>
<td></td>
<td>86400</td>
<td>58</td>
<td>Dimension Table</td>
<td>时间维度信息</td>
</tr>
<tr>
<td>14</td>
<td>catalog_page</td>
<td>2837522</td>
<td></td>
<td>20400</td>
<td>139</td>
<td>Dimension Table</td>
<td>商品目录相关信息</td>
</tr>
<tr>
<td>15</td>
<td>household_demographics</td>
<td>144453</td>
<td></td>
<td>7200</td>
<td>20</td>
<td>Dimension Table</td>
<td>家庭基本信用信息</td>
</tr>
<tr>
<td>16</td>
<td>promotion</td>
<td>123973</td>
<td></td>
<td>1000</td>
<td>124</td>
<td>Dimension Table</td>
<td>商品促销信息</td>
</tr>
<tr>
<td>17</td>
<td>store</td>
<td>106418</td>
<td></td>
<td>402</td>
<td>265</td>
<td>Dimension Table</td>
<td>商户信息</td>
</tr>
<tr>
<td>18</td>
<td>web_page</td>
<td>197009</td>
<td></td>
<td>2040</td>
<td>97</td>
<td>Dimension Table</td>
<td>商品网页基本信息</td>
</tr>
<tr>
<td>19</td>
<td>web_site</td>
<td>6850</td>
<td></td>
<td>24</td>
<td>285</td>
<td>Dimension Table</td>
<td>商品网站基本信息</td>
</tr>
<tr>
<td>20</td>
<td>call_center</td>
<td>9326</td>
<td></td>
<td>30</td>
<td>311</td>
<td>Dimension Table</td>
<td>客户服务中心相关信息</td>
</tr>
<tr>
<td>21</td>
<td>reason</td>
<td>1904</td>
<td></td>
<td>55</td>
<td>35</td>
<td>Dimension Table</td>
<td>用户退货原因</td>
</tr>
<tr>
<td>22</td>
<td>warehouse</td>
<td>1767</td>
<td></td>
<td>15</td>
<td>118</td>
<td>Dimension Table</td>
<td>仓库基本信息</td>
</tr>
<tr>
<td>23</td>
<td>ship_mode</td>
<td>1093</td>
<td></td>
<td>20</td>
<td>55</td>
<td>Dimension Table</td>
<td>商品快递信息</td>
</tr>
<tr>
<td>24</td>
<td>income_band</td>
<td>308</td>
<td></td>
<td>20</td>
<td>15</td>
<td>Dimension Table</td>
<td>收入信息</td>
</tr>
</tbody>
</table>
<p> </p>
<h2 id="2-测试流程">2. 测试流程</h2>
<h4 id="21-申请tpc官方benchmark工具包及文档">2.1 申请TPC官方Benchmark工具包及文档</h4>
<ul>
<li>官网下载地址：<a href="http://tpc.org/tpc_documents_current_versions/current_specifications5.asp">TPC Download Current Specs/Source</a></li>
<li>注意事项：申请测试包需要<strong>切换到外网环境</strong>，否则无法弹出官网的人机验证，如下图 <em>Figure 1</em>；</li>
<li>官方介绍文档不用切换网络环境，可以下载，内容涉及工具包的更新log，查询SQL反馈的实际业务目的，ER图等等......</li>
<li>如果没有外网条件或嫌麻烦，可以下载在此v3.2.0rc1版本TPC-DS工具包：<a href="https://www.aliyundrive.com/s/gLQsFopqqME">阿里云盘分享</a><br>
<img src="https://img-blog.csdnimg.cn/19eab3411b044407bb9ef46a3f06e92c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5b-X5piOMTk5NQ==,size_47,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Figure 1. 人机身份验证必须使用外网才可以刷出来" loading="lazy"><br>
 </li>
</ul>
<h4 id="22-安装tpc-ds工具包-base-on-linux">2.2 安装TPC-DS工具包 （base on Linux）</h4>
<ul>
<li>要安装依赖；</li>
</ul>
<pre><code class="language-powershell">yum -y install  gcc gcc-c++ libstdc++-devel bison byacc flex
</code></pre>
<ul>
<li>解压缩zip工具包;</li>
</ul>
<pre><code class="language-powershell">unzip tpc-ds-3.2.0rc1-tool.zip
</code></pre>
<ul>
<li>进入tools目录，执行Makefile编译（无报错，表示执行成功，如 下图<em>Figure 2</em>）；<br>
<img src="https://img-blog.csdnimg.cn/2e274256373948898896ac805d693f00.png#pic_center" alt="Figure 2. 在tools目录下执行Makefile指令成功状况" loading="lazy"></li>
</ul>
<h4 id="23-修改建表语句使其符合-aws-redshift-标准的ddl">2.3 修改建表语句，使其符合 AWS Redshift 标准的DDL</h4>
<ul>
<li>tools目录下的 tpcds.sql 文件即TPC提供的标准建表语句，但其并不适用于Redshift；</li>
<li>此步骤可参考AWS官方实践的Benchmark所提供DDL文件(GitHub)；<br>
—— <a href="https://github.com/awslabs/amazon-redshift-utils/tree/master/src/CloudDataWarehouseBenchmark/Cloud-DWB-Derived-from-TPCDS/3TB">Cloud-DWB-Derived-from-TPCDS</a></li>
<li>官方提供的DDL.sql文件已对于每张测试表都<strong>调整好了分布键和排序键</strong>，能较好的发挥性能；</li>
<li>但其基于的是TPC-DS v2.13，仍需要修改DDL.sql部分字段；</li>
<li>可参考这里我提供的基于AWS 官方DDL.sql修改后的建表文件；<br>
—— <a href="https://github.com/hezhiming1995/TPC-DS-for-Redshift/blob/main/DDL.SQL">TPCDS_for_redshift_DDL</a></li>
</ul>
<p> </p>
<h4 id="24-构建测试数据集">2.4 构建测试数据集</h4>
<ul>
<li>创建测试数据集文件存放的目录；</li>
</ul>
<pre><code class="language-powershell">mkdir data100g
</code></pre>
<ul>
<li>在tools目录下，构建测试数据集；</li>
</ul>
<pre><code class="language-powershell">./dsdgen -SCALE 100 -DIR ./data100g -SUFFIX .csv -TERMINATE N
</code></pre>
<ul>
<li>./dsdgen命令参数说明；</li>
</ul>
<pre><code class="language-powershell">[admin@cdp-wh-163 ~]$ ./dsdgen -help
dsdgen Population Generator (Version 3.2.0)
Copyright Transaction Processing Performance Council (TPC) 2001 - 2021


USAGE: dsdgen [options]

Note: When defined in a parameter file (using -p), parmeters should use the form below. 
Each option can also be set from the command line, using a form of '-param 
[optional argument]' Unique anchored substrings of options are also recognized, 
and case is ignored, so '-sc' is equivalent to '-SCALE'

General Options
===============
ABREVIATION =  &lt;s&gt;       -- build table with abreviation &lt;s&gt;
DIR =  &lt;s&gt;               -- generate tables in directory &lt;s&gt;
HELP =  &lt;n&gt;              -- display this message
PARAMS =  &lt;s&gt;            -- read parameters from file &lt;s&gt;
QUIET =  [Y|N]           -- disable all output to stdout/stderr
SCALE =  &lt;n&gt;             -- volume of data to generate in GB
TABLE =  &lt;s&gt;             -- build only table &lt;s&gt;
UPDATE =  &lt;n&gt;            -- generate update data set &lt;n&gt;
VERBOSE =  [Y|N]         -- enable verbose output
PARALLEL =  &lt;n&gt;          -- build data in &lt;n&gt; separate chunks
CHILD =  &lt;n&gt;             -- generate &lt;n&gt;th chunk of the parallelized data
RELEASE =  [Y|N]         -- display the release information
_FILTER =  [Y|N]         -- output data to stdout
VALIDATE =  [Y|N]        -- produce rows for data validation

Advanced Options
===============
DELIMITER =  &lt;s&gt;         -- use &lt;s&gt; as output field separator
DISTRIBUTIONS =  &lt;s&gt;     -- read distributions from file &lt;s&gt;
FORCE =  [Y|N]           -- over-write data files without prompting
SUFFIX =  &lt;s&gt;            -- use &lt;s&gt; as output file suffix
TERMINATE =  [Y|N]       -- end each record with a field delimiter
VCOUNT =  &lt;n&gt;            -- set number of validation rows to be produced
VSUFFIX =  &lt;s&gt;           -- set file suffix for data validation
RNGSEED =  &lt;n&gt;           -- set RNG seed
</code></pre>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>-scale &lt;n&gt;</td>
<td>生成多少的数据集（GB）</td>
<td>-scale 100，生成100GB</td>
</tr>
<tr>
<td>-DIR &lt;s&gt;</td>
<td>生成的数据集存放于&lt;s&gt;目录下</td>
<td>-DIR ./data100g | 在当前目录下的data100g下生成数据集</td>
</tr>
<tr>
<td>-SUFFIX &lt;s&gt;</td>
<td>使用&lt;s&gt;作为输出文件后缀</td>
<td>-SUFFIX .csv | 以.csv为每份数据集的文件名后缀</td>
</tr>
<tr>
<td>-TERMINATE &lt;Y|N&gt;</td>
<td>每行最后是否加字段分隔符</td>
<td>N或者Y |  N：每行最后不加字段分隔符。Y：每行最后添加字段分隔符。比如分隔符|。</td>
</tr>
<tr>
<td>-TABLE &lt;s&gt;</td>
<td>仅生成测试表 &lt;s&gt;的数据</td>
<td>-TABLE call_center</td>
</tr>
<tr>
<td>-PARALLEL</td>
<td>一共分成几个chunk。一条shell只能生成一个chunk。因此设置了几个，就要执行几次。</td>
<td>-PARALLEL 5</td>
</tr>
<tr>
<td>-CHILD</td>
<td>当前shell命令用于生成第几个chunk。</td>
<td>-PARALLEL 5 -CHILD 1</td>
</tr>
</tbody>
</table>
<blockquote>
<p>-PARALLEL -CHILD适用于生成超大型的数据（&gt;=1TB），以此合理利用机器性能，从而节省数据准备时间。<br>
因为./dsdgen是单线程程序，所以可以在后台启动多个./dsdgen多进程并发执行数据的生成。</p>
</blockquote>
<h4 id="25-加载数据到redshift中">2.5 加载数据到Redshift中</h4>
<blockquote>
<p><strong>请注意：这里我采用的是先将数据上传至S3，再从S3将数据COPY到Redshift中，有更优的方式请忽略此步骤；</strong></p>
</blockquote>
<ol>
<li>上传测试数据集至S3;</li>
</ol>
<pre><code class="language-powershell">aws s3 cp ../data100g/ s3://&lt;PATH&gt;/TPC-DS_v3.2.0/scale-100GB/ --recursive
## 推荐使用nohup后台执行上传操作，操作日志保留在当前目录下的nohup.out文件中
nohup aws s3 cp ../data100g/ s3://&lt;PATH&gt;/TPC-DS_v3.2.0/scale-100GB/ --recursive &amp;
</code></pre>
<ol start="2">
<li><strong>加载S3数据到Redshift中</strong>，这里我采用了Python脚本的方式进行COPY；</li>
</ol>
<pre><code class="language-python">#!/usr/bin/python
# -*- coding: UTF-8 -*-

import psycopg2

conn = psycopg2.connect(dbname='x', host='x', port='x', user='x', password='x')
cursor=conn.cursor()

tableName_TPCDS = ('dbgen_version','customer_address','customer_demographics','date_dim','warehouse','ship_mode','time_dim','reason','income_band','item','store','call_center','customer','web_site',
        'store_returns','household_demographics','web_page','promotion','catalog_page','inventory','catalog_returns','web_returns','web_sales','catalog_sales','store_sales')
for item in tableName_TPCDS:
        query = &quot;copy &lt;Redshift SCHEMA&gt;.&quot;+item+&quot; from 's3://&lt;S3 PATH of TPC-DS DATA&gt;&quot;+item+&quot;.csv' iam_role 'arn:aws-cn:iam::&lt;XXX&gt;' ACCEPTINVCHARS EMPTYASNULL BLANKSASNULL MAXERROR 3&quot;
        print(query)
        cursor.execute(query)
        cursor.close()
        conn.commit()
conn.close()
</code></pre>
<blockquote>
<p><strong>请注意</strong>：从S3执行COPY命令上载大型文件时，可能会提示 <strong>internal Error disk full</strong><br>
a. (<a href="https://aws.amazon.com/cn/premiumsupport/knowledge-center/redshift-high-disk-usage/">AWS官方解释:复制大型文件报磁盘已满的错误</a>)<br>
b. Solution：24张表的数据<strong>分表COPY</strong>；<strong>压缩后进行COPY</strong>；<strong>大型事实表分块执行COPY</strong>；</p>
</blockquote>
<ul>
<li>校验数据是否有全部导入到Redshift中（匹配Redshift 对应Table中的行数）</li>
</ul>
<pre><code class="language-sql">select count(*) from TABLE_NAME;
</code></pre>
<p> </p>
<h4 id="26-生成redshift标准查询流">2.6 生成Redshift标准查询流</h4>
<p>在tools目录下，通过<strong>dsdgen</strong>命令生成对应的SQL语法及对应数据量级的测试数据</p>
<ul>
<li>./dsdgen命令主要参数说明；</li>
</ul>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>-scale &lt;n&gt;</td>
<td>假设数据库的大小为 &lt;n&gt;（GB）</td>
<td>-scale 100，生成100GB</td>
</tr>
<tr>
<td>-DIALECT &lt;s&gt;</td>
<td>生成定义为SQL方言 &lt;s&gt;的查询语句</td>
<td>-DIALECT oracle | 生成oracle语法标准的查询SQL</td>
</tr>
<tr>
<td>-OUTPUT_DIR &lt;s&gt;</td>
<td>将查询流写入目录 &lt;s&gt;</td>
<td>-OUTPUT_DIR ./queries | 在当前目录下的queries目录中生成查询SQL文件</td>
</tr>
<tr>
<td>-INPUT &lt;s&gt;</td>
<td>从 &lt;s&gt;文件中读取查询SQL的模板名</td>
<td>-input ../query_templates/templates.lst | 从query_templates目录下的templates.lst文件中读取所有的queryX.tpl查询SQL模板</td>
</tr>
<tr>
<td>-DIRECTORY &lt;s&gt;</td>
<td>在 &lt;s&gt; 中查询模板</td>
<td>-DIRECTORY ../query_templates/ | 在query_templates目录中寻找查询SQL模板</td>
</tr>
<tr>
<td>-TEMPLATE  &lt;s&gt;</td>
<td>仅从模板 &lt;s&gt;生成查询SQL模板</td>
<td>-TEMPLATE &quot;query63.tpl&quot; | 仅根据query63.tpl模板生成查询SQL</td>
</tr>
<tr>
<td>-FILTER &lt;Y|N&gt;</td>
<td>将生成的查询SQL写入标准输出 (stdout)</td>
<td>-FILTER Y &gt;../queries/query63.sql</td>
</tr>
</tbody>
</table>
<ul>
<li>由上参数说明可知，有两种生成查询SQL的方式：1.<strong>单独生成每一个查询SQL；</strong> 2.<strong>从文件中批量读取模板生成一个SQL但包含多个查询</strong></li>
</ul>
<p>以下是我编写的两个脚本用于生成打乱顺序的组合查询SQL，和批量生成独立99个的SQL；</p>
<ul>
<li>在tools目录下，<strong>将99个测试Query打乱顺序生成到一个SQL文件中，重复生成10组</strong>：</li>
</ul>
<pre><code class="language-python">#!/usr/bin/python
# -*- coding: UTF-8 -*-

import random
import os

print(&quot;Generate TPC-DS 99 Query SQL&quot;)
# 生成一个数组x，存储1-99数字
x = [i for i in range(1,100)]

for i in range(1,11):
    # 随机打乱x数组，打乱10次
    random.shuffle(x)
    # 拼接dsqgen可执行的Query SQL集合文件名
    templates=&quot;templates_&quot;+str(i)+&quot;.lst&quot;
    # 打开对应目录下的Query SQL集合文件
    tempFile = open(&quot;../query_templates/&quot;+templates,'a')
    # 随机插入打乱顺序的Query SQL名到集合文件中
    for j in range(1,100):
        tpl = &quot;query&quot;+str(x[j-1])+&quot;.tpl&quot;
        tempFile.write(tpl+&quot;\n&quot;)
    tempFile.close()
    # 拼接10个总query SQL文件名
    totalQueryName = &quot;totalQuery_&quot;+str(i)+&quot;.sql&quot;
    # 拼接dsqgen命名，用于生成10个总的query SQL
    cmd = &quot;./dsqgen -input ../query_templates/&quot;+templates+&quot; -directory ../query_templates -dialect netezza -scale 100 -FILTER Y &gt; ../data/queries/Query_100GB/totalQueries/&quot;+totalQueryName
    os.system(cmd)
</code></pre>
<ul>
<li>在tools目录下，<strong>分别独立生成99个测试Query的SQL文件</strong>：</li>
</ul>
<pre><code class="language-python">#!/usr/bin/python
# -*- coding: UTF-8 -*-

import os

print(&quot;generate query sql&quot;)
# 遍历1-99
for i in range(1,100):
    tpl = &quot;query&quot;+str(i)+&quot;.tpl&quot;
    qsql = &quot;query&quot; +str(i) +&quot;.sql&quot;
    # 拼接命令
    cmd = &quot;./dsqgen -DIRECTORY ../query_templates/ &quot;+&quot;-TEMPLATE &quot;+tpl+&quot; -DIALECT netezza -scale 100 -FILTER Y &gt; &quot;+&quot;../data/Query_100GB/queries/&quot;+qsql
    #print(cmd)
    #执行命令
    os.system(cmd)
</code></pre>
<p> </p>
<h2 id="3-修改为redshift标准语法的查询query">3. 修改为Redshift标准语法的查询Query</h2>
<blockquote>
<p><strong>Tips. 在生成或执行Query的SQL时，会有很多问题。以下是我汇总的所有问题的解决方案。通过修改对应的query模板，使其最终生成Redshift语法的sql。</strong></p>
</blockquote>
<ol>
<li>执行命令时提示：<strong>ERROR: Substitution '_END' is used before being initialized</strong>…</li>
</ol>
<p>在工具包的query_templates目录下，找到你所采用的SQL <em>“方言”</em>（Dialect ）文件，官方仅支持ansi，db2，Netezza，oracle，sqlserver这五个SQL Dialect，在您使用的SQL Dialect文件末尾添加以下两列；<br>
<img src="https://img-blog.csdnimg.cn/679f079b20ba47e4a5cc81632e72810c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5b-X5piOMTk5NQ==,size_50,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="Figure3-TPC-DS SQL Dialect" loading="lazy"></p>
<pre><code class="language-powershell">define _BEGIN = &quot;-- start query &quot; + [_QUERY] + &quot; in stream &quot; + [_STREAM] + &quot; using template &quot; + [_TEMPLATE];
define _END = &quot;&quot;;
</code></pre>
<ul>
<li>
<p>AWS Redshift不支持<strong>ROLLUP &amp; GROUPING函数</strong><br>
—— queries 5, 14, 18, 22, 27, 35, 36, 67, 70, 77, 80, and 86需要变形，可以从../query_variants目录下复制官方提供的已变形文件；</p>
</li>
<li>
<p>AWS Redshift中对<strong>Date类的字段加减操作</strong> (e.g., + 14 days) 不适配<br>
—— queries 5, 12, 16, 20, 21, 32, 37, 40, 77, 80, 82, 92, 94, 95 and 98需要变形，去除 days关键字</p>
</li>
<li>
<p>AWS Redshift <strong>不支持SUBSTR函数</strong><br>
—— queries 8, 15, 19, 23, 45, 62, 79, 85 and 99需要变形，修改为<strong>SUBSTRING()函数</strong></p>
</li>
<li>
<p><strong>基础语法错误</strong><br>
—— <strong>query77a.tpl</strong> 76行错误，缺少’,’分割符，135行错误，缺少’as’连接符，进行修改<br>
 </p>
</li>
</ul>
<h2 id="4-执行query统计时间">4. 执行Query，统计时间</h2>
<h4 id="41-脚本后台执行query-python">4.1 脚本后台执行Query (python)</h4>
<p>由于篇幅问题，这里只粘贴执行<strong>组合query的SQL文件</strong>的测试脚本。考量范围有：</p>
<ul>
<li>开启<strong>Redshift Result Cache</strong>与不开启对于查询性能的影响；</li>
<li>执行五次，统计<strong>取平均值</strong>；</li>
<li>设置<strong>默认的Redshift Schema</strong>，以便不用修改每一个查询sql；</li>
<li>每一次执行保留运行数据到pandas.DataFrame数据结构中，<strong>统计结果输出到cvs文件</strong>；</li>
</ul>
<pre><code class="language-python">#!/usr/bin/python
# -*- coding: UTF-8 -*-

import psycopg2
import pandas as pd
import datetime

#### /home/admin/TPC-DS_Tools_v3.2.0/data/queries/Query_100GB/totalQueries

# Get Redshift Connection
conn = psycopg2.connect(dbname='****', host='****', port='****', user='****', password='****')

# Create an empty pandas.DataFrame to store excute results
df_TPCDS_Result = pd.DataFrame(columns=['SQLName','No#Runs','resultCache','resultPath','startTime','endTime','costTime'])
for i in range(1,11):
    if (i&gt;=6):
        resultCache = 'on'
    else:
        resultCache ='off'
    for j in range(1,11):

        # Configure the current querySQL x path

        queryName = &quot;totalQuery_&quot; +str(j) +&quot;.sql&quot;
        queryPath = &quot;./totalQueries/&quot; +queryName

        # open querySQL x
        queryFile = open(queryPath,'r')
        querySQL = queryFile.read()

        # Create Cursor object
        cursor=conn.cursor()

        startTime = datetime.datetime.now()

        # Setting inapplicable result cache
        cursor.execute(&quot;set enable_result_cache_for_session to %s;&quot; %resultCache)

        # Setting default schema
        cursor.execute(&quot;set search_path to &lt;Redshift SCHEMA&gt;;&quot;)
        # excute querySQL x
        cursor.execute(querySQL)
        # Get excute querySQL x result
        data = cursor.fetchall()

        endTime = datetime.datetime.now()
        costSeconds = (endTime - startTime).seconds
        costMicroSeconds = (endTime - startTime).microseconds
        costTime = round(costSeconds+costMicroSeconds/1000000,2)
        print(&quot;The Total Time is: %s seconds&quot; %costTime)

        queryFile.close()
        
        # Query result visualization
        resultData = pd.DataFrame(data)
        resultFilePath = &quot;./totalResult/totalQuery&quot;+str(j)+&quot;_No#Runs&quot;+str(i)+&quot;.csv&quot;
        resultData.to_csv(resultFilePath,header=None,index=None)

        # print(resultData)

        conn.commit()
        cursor.close()
        
        newList = {'SQLName':queryName,'No#Runs':i,'resultCache':resultCache,'resultPath':resultFilePath,'startTime':startTime,'endTime':endTime,'costTime':costTime}
        df_TPCDS_Result = df_TPCDS_Result.append(newList,ignore_index=True)

print(df_TPCDS_Result)
overallResultFilePath = &quot;./totalResult/overallTotalResultView.csv&quot;
df_TPCDS_Result.to_csv(overallResultFilePath)
conn.close()
</code></pre>
<h2 id="5-结果展示">5. 结果展示</h2>
<p><a href="https://www.aliyundrive.com/s/rA45wPM8ZPv">原图太大了，这里我放到云盘了(阿里云盘)</a><br>
下图建议右击在新标签页打开，或保存到本地查看。<br>
<img src="https://img-blog.csdnimg.cn/108443b903aa4572be48324615ea4742.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5b-X5piOMTk5NQ==,size_714,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="建议右击在新标签页打开" loading="lazy"><br>
<img src="https://img-blog.csdnimg.cn/5b946dd75870452abe6d0957fd1d1a34.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5b-X5piOMTk5NQ==,size_261,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="建议右击在新标签页打开" loading="lazy"><br>
<img src="https://img-blog.csdnimg.cn/88bf5dcb923d4b869a8a8f8bd483240d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5b-X5piOMTk5NQ==,size_263,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="建议右击在新标签页打开" loading="lazy"></p>
<h4 id="51-结论">5.1 结论</h4>
<blockquote>
<p>TPC-DS v3.2.0 100GB数据量级</p>
</blockquote>
<ul>
<li><strong>开启Result Cache和不开启Result Cache的查询速率</strong>上，相差大约在1~16560倍之间；</li>
<li>绝大多数情况，<strong>无论是开启或不开启Result Cache，第一次执行查询所耗时间远高于之后执行相同查询的所耗时间</strong>，相差大约在1~9446倍之间；</li>
<li>不开启Result Cache，99个Query的平均查询时间相加共计：2979s (With Frist Run)</li>
<li>不开启Result Cache，99个Query的平均查询时间相加共计：1645s (With Frist Run)</li>
<li>开启Result Cache，99个Query的平均查询时间相加共计：372s (Without Frist Run)</li>
<li>开启Result Cache，99个Query的平均查询时间相加共计：47s (Without Frist Run)</li>
<li>不开启Result Cache，第一次运行Query的查询时间相加为：8316s (02:18:06)</li>
<li>开启Result Cache，第一次运行Query的查询时间相加为：1672s (00:27:52)</li>
</ul>
<h2 id="6-references">6 References</h2>
<p>[1]: <a href="https://aws.amazon.com/cn/blogs/big-data/get-up-to-3x-better-price-performance-with-amazon-redshift-than-other-cloud-data-warehouses/">AWS官方测试结论</a><br>
[2]: <a href="https://github.com/awslabs/amazon-redshift-utils/tree/master/src/CloudDataWarehouseBenchmark/Cloud-DWB-Derived-from-TPCDS">AWS官方测试代码</a><br>
[3]: <a href="https://blog.csdn.net/u011563666/article/details/78751584">TPC-DS性能测试及使用方法</a><br>
[4]: <a href="https://blog.csdn.net/qq_31382921/article/details/102521883">如何进行TPC-DS测试</a><br>
[5]: <a href="https://new.qq.com/rain/a/20210602A05JAT00">聊聊TPC那些事儿</a><br>
[6]: <a href="https://help.aliyun.com/document_detail/155979.html">阿里云：基于标准测试集的测试说明</a></p>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li><a href="#%E9%80%82%E7%94%A8%E4%BA%8E-aws-redshift-%E7%9A%84-tpc-ds-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95">适用于 AWS Redshift 的 TPC-DS 基准测试</a>
<ul>
<li><a href="#1-%E7%BB%84%E4%BB%B6%E7%8E%AF%E5%A2%83">1. 组件环境</a><br>
*
<ul>
<li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AFtpc-ds">1.1 什么是TPC-DS？</a></li>
<li><a href="#12-tpc-ds%E7%9A%84%E7%89%B9%E6%80%A7">1.2 TPC-DS的特性</a></li>
<li><a href="#13-tpc-ds-%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E7%BB%B4%E5%BA%A6">1.3 TPC-DS 基准测试维度</a></li>
<li><a href="#14-tpc-ds-%E6%B5%8B%E8%AF%95%E8%A1%A8%E6%95%B0%E6%8D%AE%E8%AF%A6%E6%83%85">1.4 TPC-DS 测试表数据详情</a></li>
</ul>
</li>
<li><a href="#2-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B">2. 测试流程</a><br>
*
<ul>
<li><a href="#21-%E7%94%B3%E8%AF%B7tpc%E5%AE%98%E6%96%B9benchmark%E5%B7%A5%E5%85%B7%E5%8C%85%E5%8F%8A%E6%96%87%E6%A1%A3">2.1 申请TPC官方Benchmark工具包及文档</a></li>
<li><a href="#22-%E5%AE%89%E8%A3%85tpc-ds%E5%B7%A5%E5%85%B7%E5%8C%85-base-on-linux">2.2 安装TPC-DS工具包 （base on Linux）</a></li>
<li><a href="#23-%E4%BF%AE%E6%94%B9%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5%E4%BD%BF%E5%85%B6%E7%AC%A6%E5%90%88-aws-redshift-%E6%A0%87%E5%87%86%E7%9A%84ddl">2.3 修改建表语句，使其符合 AWS Redshift 标准的DDL</a></li>
<li><a href="#24-%E6%9E%84%E5%BB%BA%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E9%9B%86">2.4 构建测试数据集</a></li>
<li><a href="#25-%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0redshift%E4%B8%AD">2.5 加载数据到Redshift中</a></li>
<li><a href="#26-%E7%94%9F%E6%88%90redshift%E6%A0%87%E5%87%86%E6%9F%A5%E8%AF%A2%E6%B5%81">2.6 生成Redshift标准查询流</a></li>
</ul>
</li>
<li><a href="#3-%E4%BF%AE%E6%94%B9%E4%B8%BAredshift%E6%A0%87%E5%87%86%E8%AF%AD%E6%B3%95%E7%9A%84%E6%9F%A5%E8%AF%A2query">3. 修改为Redshift标准语法的查询Query</a></li>
<li><a href="#4-%E6%89%A7%E8%A1%8Cquery%E7%BB%9F%E8%AE%A1%E6%97%B6%E9%97%B4">4. 执行Query，统计时间</a><br>
*
<ul>
<li><a href="#41-%E8%84%9A%E6%9C%AC%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8Cquery-python">4.1 脚本后台执行Query (python)</a></li>
</ul>
</li>
<li><a href="#5-%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA">5. 结果展示</a><br>
*
<ul>
<li><a href="#51-%E7%BB%93%E8%AE%BA">5.1 结论</a></li>
</ul>
</li>
<li><a href="#6-references">6 References</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                            <!--zh-->
                                            <section class="post-copyright zh">
                                                <p class="copyright-item ">
                                                    <span>&#x4F5C;&#x8005;:</span>
                                                    <span>Zhiming's Blog</span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                                    <span><a href="https://hezhiming1995.github.io/post/gua-yong-yu-aws-redshift-de-tpc-ds-ji-zhun-ce-shi/">https://hezhiming1995.github.io/post/gua-yong-yu-aws-redshift-de-tpc-ds-ji-zhun-ce-shi/</a></span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x534F;&#x8BAE;:</span>
                                                    <span>MIT License</span>
                                                </p>
                                            </section>
                                            
                                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR 码" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://hezhiming1995.github.io/post/gua-yong-yu-aws-redshift-de-tpc-ds-ji-zhun-ce-shi/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://hezhiming1995.github.io/post/gua-yong-yu-aws-redshift-de-tpc-ds-ji-zhun-ce-shi/&sharesource=qzone&title=适用于 AWS Redshift 的 TPC-DS 基准测试&pics=https://hezhiming1995.github.io/images/avatar.png?v=1700489200796&summary="><i class="fa fa-qq"></i></a>
                                                                    <a title="新浪微博" target="_blank" href="https://service.weibo.com/share/share.php?url=https://hezhiming1995.github.io/post/gua-yong-yu-aws-redshift-de-tpc-ds-ji-zhun-ce-shi/&sharesource=weibo&title=适用于 AWS Redshift 的 TPC-DS 基准测试 + " - " + &pic="https://hezhiming1995.github.io/images/avatar.png?v=1700489200796 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                        
                        <a href="https://hezhiming1995.github.io/tag/redshift/">#
                    Redshift
                        </a>
                        
                        <a href="https://hezhiming1995.github.io/tag/tpc-ds/">#
                    TPC-DS
                        </a>
                        
                        <a href="https://hezhiming1995.github.io/tag/benchmark/">#
                    Benchmark
                        </a>
                        
                        <a href="https://hezhiming1995.github.io/tag/data-warehouse/">#
                    Data Warehouse
                        </a>
                        
                        <a href="https://hezhiming1995.github.io/tag/shu-ju-cang-ku/">#
                    数据仓库
                        </a>
                        
                        <a href="https://hezhiming1995.github.io/tag/ji-zhun-ce-shi/">#
                    基准测试
                        </a>
                        
                            
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://hezhiming1995.github.io/post/qian-tan-aws-s3/">
                                                                                            浅谈 AWS S3
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://hezhiming1995.github.io/post/wei-shi-me-yao-jin-xing-shu-ju-cang-ku-de-fen-ceng-she-ji-ni/">
                                                                                                    为什么要进行数据仓库的分层设计呢？
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                    
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container" style="width: 100%;max-width: 780px;margin: auto;"></div>

<script>
    var gitalk = new Gitalk({
        clientID: 'b04fd00e2a686d0b783c',
        clientSecret: '762b106f86da3ace975f7778f6a89180ce13c6b5',
        repo: 'hezhiming1995.github.io',
        owner: 'hezhiming1995',
        admin: ['hezhiming1995'],
        id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
        distractionFreeMode: false // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
                            
                                        
                                            
            </div>
    </div>
    </div>
    </div>
    
    <div id="player"></div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        “写作是不被打扰的最佳谈话方式。” —— 儒勒·雷纳德 <br>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        Zhiming&#39;s Blog &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://pages.github.com" target="_blank">
                                                Github Page
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.6
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
                <script>
                    

                    function LoadPlayer() {
                        var musicList = [];
                        
                        musicList.push({
                            name: '云之境',
                            url: 'http://music.163.com/song/media/outer/url?id=1910710814.mp3',
                            artist: '目索',
                            cover: 'http://p1.music.126.net/SxGxGqRD5woVoxf6KjEVtg==/109951166910587711.jpg?param=130y130',
                        });
                        
                        musicList.push({
                            name: 'Kiss The Rain',
                            url: 'http://music.163.com/song/media/outer/url?id=1299980643.mp3',
                            artist: 'Yiruma',
                            cover: 'http://p1.music.126.net/HDQuWNUZk2-hLfj1zvhZPQ==/109951164910494901.jpg?param=130y130',
                        });
                        
                        musicList.push({
                            name: 'Endless Horizon',
                            url: 'http://music.163.com/song/media/outer/url?id=5268176.mp3',
                            artist: 'Bandari',
                            cover: 'http://p2.music.126.net/RvYXgoYJaOyjzak_3sBDdg==/109951167728410139.jpg?param=130y130',
                        });
                        
                        musicList.push({
                            name: 'Tears眼泪',
                            url: 'http://music.163.com/song/media/outer/url?id=1444233940.mp3',
                            artist: '顾彬',
                            cover: 'http://p1.music.126.net/4H0SO_iVzAl839EnE-IO1w==/109951166632235270.jpg?param=130y130',
                        });
                        
                        musicList.push({
                            name: 'Long Way Home',
                            url: 'http://music.163.com/song/media/outer/url?id=521169592.mp3',
                            artist: 'Lamplighters (点灯人)',
                            cover: 'http://p1.music.126.net/aBXLT2GnuSeWHrsMxgmOmg==/109951163321516604.jpg?param=130y130',
                        });
                        
                        musicList.push({
                            name: 'Snowdreams',
                            url: 'http://music.163.com/song/media/outer/url?id=421110447.mp3',
                            artist: 'Bandari',
                            cover: 'http://p1.music.126.net/wiYRpp1E5y_Fb2HLOVpEHw==/17696639649365278.jpg?param=130y130',
                        });
                        
                        musicList.push({
                            name: '布列瑟农',
                            url: 'http://music.163.com/song/media/outer/url?id=5241565.mp3',
                            artist: 'Matthew Lien',
                            cover: 'http://p1.music.126.net/B63O50RY3BFM8_Bzsk6ITA==/123145302328910.jpg?param=130y130',
                        });
                        
                        console.log(" MusicList: " + musicList);
                        
                        const ap = new APlayer({
                            container: document.getElementById('player'),
                            fixed: true,
                            audio: musicList
                        });
                        
                    }
                    LoadPlayer();
                    
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1700489200796);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>